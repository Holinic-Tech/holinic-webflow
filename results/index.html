<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Your Hair Recovery Report</title>
  <style>
    :root {
      --ink: #232946;
      --rose: #eebbc3;
      --bg: #fafafa;
      --card: #ffffff;
      --muted: #6b7280;
    }
    * { box-sizing: border-box; }
    body {
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Inter, Arial, sans-serif;
      margin: 0;
      background: var(--bg);
      color: #222;
      line-height: 1.6;
    }
    header {
      background: var(--ink);
      color: #fff;
      padding: 1.5rem;
      text-align: center;
    }
    header h1 { margin: 0 0 .25rem; font-size: 1.9rem; }
    header p { margin: 0; opacity: .9; }

    main {
      max-width: 960px;
      margin: 2rem auto;
      padding: 1rem;
    }
    .card {
      background: var(--card);
      border-radius: 12px;
      box-shadow: 0 2px 10px rgba(0,0,0,.06);
      padding: 1.2rem 1.1rem;
      margin-bottom: 1rem;
    }
    h2 { color: var(--ink); font-size: 1.35rem; margin: 0 0 .6rem; }
    h3 { margin: .5rem 0; }
    .anchors p { margin: .25rem 0; color: #111; }
    .muted { color: var(--muted); }

    /* Week sections */
    .week {
      border-left: 4px solid var(--rose);
      padding-left: 1rem;
      margin: 1rem 0 1.2rem;
    }
    .practice-block { margin: 1rem 0; }
    .practice-title {
      font-weight: 600;
      margin: 0 0 .35rem;
      color: #111;
    }
    .practice-body { background: #fff8fa; border: 1px solid #f6dfe6; border-radius: 10px; padding: .8rem; }
    .placeholder { color: var(--muted); font-style: italic; }

    footer {
      text-align: center;
      font-size: .9rem;
      color: var(--muted);
      margin: 2rem 0;
    }
    @media (max-width: 720px) {
      header h1 { font-size: 1.6rem; }
      main { padding: .5rem; }
    }
  </style>
</head>
<body>
  <header>
    <h1>‚ú® Your Hair Recovery Report</h1>
    <p>Personalized insights from Hairqare</p>
  </header>

  <main>
    <!-- Intro -->
    <section class="card" id="intro">
      <h2>Where You Are Right Now</h2>
      <p>This report helps you understand what‚Äôs driving your shedding, where you are in the recovery cycle, and what to focus on over the next 3 weeks. üå±</p>
      <p class="muted" id="phase-pill"></p>
    </section>

    <!-- Timeline -->
    <section class="card" id="timeline">
      <h2>Your Recovery Timeline</h2>
      <div id="timeline-html"><p class="muted">Loading analysis‚Ä¶</p></div>
      <div id="anchors" class="anchors"></div>
    </section>

    <!-- Protocols -->
    <section class="card" id="protocol">
      <h2>Your 21-Day Reset Plan</h2>

      <div class="week" id="week1">
        <h3>Week 1: Stabilize Your System üå±</h3>

        <!-- PRACTICE 1 (wired to Make/GPT) -->
        <div class="practice-block" id="practice1">
          <div class="practice-title">Practice 1: <span id="p1-title" class="muted">Loading‚Ä¶</span></div>
          <div class="practice-body" id="p1-body"><p class="placeholder">Waiting for your personalized instructions‚Ä¶</p></div>
        </div>

        <!-- PRACTICE 2 (placeholder for now) -->
        <div class="practice-block" id="practice2">
          <div class="practice-title">Practice 2: <span id="p2-title" class="muted">Coming soon</span></div>
          <div class="practice-body" id="p2-body"><p class="placeholder">This practice will appear here once generated.</p></div>
        </div>

        <!-- PRACTICE 3 (placeholder for now) -->
        <div class="practice-block" id="practice3">
          <div class="practice-title">Practice 3: <span id="p3-title" class="muted">Coming soon</span></div>
          <div class="practice-body" id="p3-body"><p class="placeholder">This practice will appear here once generated.</p></div>
        </div>
      </div>

      <!-- Week 2 placeholder -->
      <div class="week" id="week2">
        <h3>Week 2: Rebuild Your Foundations üí™</h3>
        <p class="placeholder">We‚Äôll unlock your Week 2 practices here.</p>
      </div>

      <!-- Week 3 placeholder -->
      <div class="week" id="week3">
        <h3>Week 3: Support Regrowth üå∏</h3>
        <p class="placeholder">We‚Äôll unlock your Week 3 practices here.</p>
      </div>
    </section>

    <!-- Closing -->
    <section class="card" id="closing">
      <h2>You‚Äôve Got This ‚ù§Ô∏è</h2>
      <p>Hair recovery takes patience, but every small step adds up. Thousands of women have been exactly where you are ‚Äî and they‚Äôve come through with healthier, stronger hair. Stay consistent, and your future self will thank you. ‚ú®</p>
    </section>
  </main>

  <footer>¬© 2025 Hairqare by Holiniq</footer>

  <script>
    async function loadJSON(url) {
      const res = await fetch(url);
      if (!res.ok) throw new Error(`Failed to fetch ${url}: ${res.status}`);
      return res.json();
    }

    function safeSetHTML(el, html) {
      if (!el) return;
      if (!html) {
        el.innerHTML = '<p class="placeholder">No content available yet.</p>';
        return;
      }
      el.innerHTML = html;
    }

    function setText(el, text, fallback='‚Äî') {
      if (!el) return;
      el.textContent = text || fallback;
    }

    async function boot() {
      const params = new URLSearchParams(window.location.search);
      const id = params.get('id');
      if (!id) {
        console.error('Missing ?id=');
        return;
      }

      // 1) Timeline / anchors (existing flow)
      try {
        const timelineData = await loadJSON(`./data/${id}.json`);
        // Expect either an array with [0] or an object; support both
        const t = Array.isArray(timelineData) ? timelineData[0] : timelineData;

        // Phase (optional)
        if (t.phase) {
          document.getElementById('phase-pill').textContent = `Current phase: ${t.phase}`;
        }

        // HTML analysis
        safeSetHTML(document.getElementById('timeline-html'), t.timeline_html);

        // Anchors
        const a = t.anchors || {};
        document.getElementById('anchors').innerHTML = `
          <p><strong>Worst month:</strong> ${a.worst_month ?? '‚Äî'}</p>
          <p><strong>Main trigger:</strong> ${a.main_trigger ?? '‚Äî'}</p>
          <p><strong>Onset window:</strong> ${a.onset_window ?? '‚Äî'}</p>
          <p><strong>Stabilization window:</strong> ${a.stabilization_window ?? '‚Äî'}</p>
          <p><strong>Regrowth start:</strong> ${a.regrowth_start ?? '‚Äî'}</p>
        `;
      } catch (e) {
        console.error('Timeline load error:', e);
      }

      // 2) Protocol JSON (new)
      try {
        const prot = await loadJSON(`./data/protocols/${id}.json`);
        // Week 1 ‚Äì Practice 1 (title from Make, body is full HTML from GPT)
        setText(document.getElementById('p1-title'), prot?.week1?.practice1_title, 'Not set');
        safeSetHTML(document.getElementById('p1-body'), prot?.week1?.practice1_html);

        // (Optional later) You can also populate p2/p3 the same way when ready:
        if (prot?.week1?.practice2_title) setText(document.getElementById('p2-title'), prot.week1.practice2_title);
        if (prot?.week1?.practice2_html)  safeSetHTML(document.getElementById('p2-body'), prot.week1.practice2_html);

        if (prot?.week1?.practice3_title) setText(document.getElementById('p3-title'), prot.week1.practice3_title);
        if (prot?.week1?.practice3_html)  safeSetHTML(document.getElementById('p3-body'), prot.week1.practice3_html);
      } catch (e) {
        console.warn('Protocol load warning (ok for MVP if missing):', e);
      }
    }

    boot();
  </script>
</body>
</html>