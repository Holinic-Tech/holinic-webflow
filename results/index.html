<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Your Hair Recovery Report</title>
  <style>
    :root{
      --ink:#232946;
      --bg:#fafafa;
      --card:#fff;
      --muted:#666;
      --accent:#eebbc3;
    }
    *{box-sizing:border-box}
    body{
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      margin:0; color:#222; background:var(--bg); line-height:1.6;
    }
    header{background:var(--ink); color:#fff; padding:1.5rem; text-align:center}
    header h1{margin:0; font-size:1.8rem}
    main{max-width:800px; margin:2rem auto; background:var(--card); padding:1.25rem 1.25rem 2rem; border-radius:12px; box-shadow:0 2px 10px rgba(0,0,0,.06)}
    section{margin-bottom:2rem}
    section h2{color:var(--ink); margin:.25rem 0 .75rem; font-size:1.35rem}
    .anchors p{margin:.2rem 0; font-size:.95rem}
    ul{padding-left:1.1rem; margin:.5rem 0}
    .week{border-left:4px solid var(--accent); padding-left:1rem; margin:1rem 0}
    .week h3{margin:.2rem 0 .4rem}
    .muted{color:var(--muted)}
    footer{text-align:center; color:#555; font-size:.9rem; margin:2rem 0}
    .warn{padding:.75rem 1rem; border-radius:8px; background:#fff4f6; color:#7a1c2a; border:1px solid #ffd6df}
    .ok{padding:.5rem .75rem; border-radius:8px; background:#f6ffef; color:#1f5d22; border:1px solid #d7f5c9}
    .dim{opacity:.85}
    .skeleton{
      background:linear-gradient(90deg, #eee, #f6f6f6, #eee);
      background-size:200% 100%;
      animation:shimmer 1.2s infinite;
      height:1rem; border-radius:6px; width:100%;
    }
    @keyframes shimmer {0%{background-position:200% 0}100%{background-position:-200% 0}}
    code.inline{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace; background:#f5f5f5; padding:.1rem .35rem; border-radius:6px}
  </style>
</head>
<body>
  <header>
    <h1>‚ú® Your Hair Recovery Report</h1>
    <p class="dim">Personalized insights from Hairqare</p>
  </header>

  <main>
    <!-- Intro -->
    <section id="intro">
      <h2>Where You Are Right Now</h2>
      <p>This report helps you understand what‚Äôs driving your shedding, where you are in the recovery cycle, and what to focus on over the next 3 weeks. üå±</p>
    </section>

    <!-- Timeline / Analysis -->
    <section id="timeline">
      <h2>Your Recovery Timeline</h2>
      <div id="timeline-html"><div class="skeleton" style="height:70px"></div></div>
      <div id="anchors" class="anchors muted" style="margin-top:.75rem"></div>
    </section>

    <!-- Protocols -->
    <section id="protocol">
      <h2>Your 21-Day Reset Plan</h2>

      <!-- Week 1 (hardcoded practices; titles filled via Make / JSON; bodies from GPT HTML) -->
      <div class="week" id="week1">
        <h3>Week 1: Stabilize Your System üå±</h3>

        <!-- Practice 1 -->
        <h4 id="p1-title">Practice 1: Consistent Sleep Timing</h4>
        <div id="p1-body" class="muted">
          <div class="skeleton" style="height:18px; width:90%"></div>
          <div class="skeleton" style="height:18px; width:85%; margin-top:.4rem"></div>
        </div>

        <!-- Practice 2 -->
        <h4 id="p2-title">Practice 2: Wind-Down Stack</h4>
        <div id="p2-body" class="muted">
          <div class="skeleton" style="height:18px; width:92%"></div>
          <div class="skeleton" style="height:18px; width:70%; margin-top:.4rem"></div>
        </div>

        <!-- Practice 3 (conditional by your Make mapping) -->
        <h4 id="p3-title">Practice 3: (will be tailored to you)</h4>
        <div id="p3-body" class="muted">
          <div class="skeleton" style="height:18px; width:88%"></div>
          <div class="skeleton" style="height:18px; width:60%; margin-top:.4rem"></div>
        </div>
      </div>

      <!-- Week 2 placeholder -->
      <div class="week" id="week2">
        <h3>Week 2: Rebuild Your Foundations üí™</h3>
        <p class="muted">This section will auto-populate soon. For now, keep momentum with Week 1.</p>
      </div>

      <!-- Week 3 placeholder -->
      <div class="week" id="week3">
        <h3>Week 3: Support Regrowth üå∏</h3>
        <p class="muted">This section will auto-populate soon. You‚Äôre doing great ‚Äî consistency compounds.</p>
      </div>
    </section>

    <!-- Closing -->
    <section id="closing">
      <h2>You‚Äôve Got This ‚ù§Ô∏è</h2>
      <p>Hair recovery takes patience, but every small step adds up. Thousands of women have been exactly where you are ‚Äî and they‚Äôve come through with healthier, stronger hair. Stay consistent, and your future self will thank you. ‚ú®</p>
    </section>

    <div id="messages"></div>
  </main>

  <footer>¬© 2025 Hairqare by Holiniq</footer>

  <script>
    const $ = (s) => document.querySelector(s);
    const safeSetHTML = (el, html) => {
      if (!el) return;
      el.innerHTML = String(html ?? '')
        .replaceAll('<script', '&lt;script')
        .replaceAll('onerror=', 'data-oe=');
    };
    const loadJSON = async (url) => {
      const r = await fetch(url, { cache: 'no-store' });
      if (!r.ok) throw new Error(`${url} ‚Üí ${r.status}`);
      return r.json();
    };
  
    async function boot() {
      const id = new URLSearchParams(location.search).get('id');
      if (!id) { console.warn('Missing ?id='); return; }
  
      // 1) Timeline (unchanged)
      try {
        const timeline = await loadJSON(`../data/${id}.json`);
        const result = Array.isArray(timeline) ? timeline[0] : timeline;
        safeSetHTML($('#timeline-html'), result.timeline_html ?? '<p class="muted">No analysis available.</p>');
        const a = result.anchors || {};
        $('#anchors').innerHTML =
          `<p><strong>Worst month:</strong> ${a.worst_month ?? '‚Äî'}</p>
           <p><strong>Main trigger:</strong> ${a.main_trigger ?? '‚Äî'}</p>
           <p><strong>Onset window:</strong> ${a.onset_window ?? '‚Äî'}</p>
           <p><strong>Stabilization by:</strong> ${a.stabilization_by ?? '‚Äî'}</p>
           <p><strong>Stabilization window:</strong> ${a.stabilization_window ?? '‚Äî'}</p>
           <p><strong>Regrowth start:</strong> ${a.regrowth_start ?? '‚Äî'}</p>`;
      } catch (e) {
        console.error('Timeline load error', e);
      }
  
      // 2) Week loaders (new paths)
      const weekPaths = [
        { n: 1, url: `../data/protocols/week1/${id}.json`, tSel: '#p1-title', bSel: '#p1-body', t2Sel: '#p2-title', b2Sel: '#p2-body', t3Sel: '#p3-title', b3Sel: '#p3-body' },
        { n: 2, url: `../data/protocols/week2/${id}.json`, tSel: '#w2-p1-title', bSel: '#w2-p1-body', t2Sel: '#w2-p2-title', b2Sel: '#w2-p2-body', t3Sel: '#w2-p3-title', b3Sel: '#w2-p3-body' },
        { n: 3, url: `../data/protocols/week3/${id}.json`, tSel: '#w3-p1-title', bSel: '#w3-p1-body', t2Sel: '#w3-p2-title', b2Sel: '#w3-p2-body', t3Sel: '#w3-p3-title', b3Sel: '#w3-p3-body' },
      ];
  
      for (const w of weekPaths) {
        try {
          const prot = await loadJSON(w.url);
          const wk = prot?.[`week${w.n}`];
          if (!wk) continue;
  
          if (wk.practice1_title) $(w.tSel).textContent = wk.practice1_title;
          if (wk.practice1_html)  safeSetHTML($(w.bSel), wk.practice1_html);
  
          if ($(w.t2Sel) && wk.practice2_title) $(w.t2Sel).textContent = wk.practice2_title;
          if ($(w.b2Sel) && wk.practice2_html)  safeSetHTML($(w.b2Sel), wk.practice2_html);
  
          if ($(w.t3Sel) && wk.practice3_title) $(w.t3Sel).textContent = wk.practice3_title;
          if ($(w.b3Sel) && wk.practice3_html)  safeSetHTML($(w.b3Sel), wk.practice3_html);
        } catch (e) {
          // fine for MVP; week may not exist yet
          console.warn(`Week ${w.n} not loaded`, e);
        }
      }
    }
  
    boot();
  </script>
</body>
</html>