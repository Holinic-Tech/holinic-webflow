<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Your Hair Recovery Report</title>
  <style>
    :root{
      --ink:#232946;
      --bg:#fafafa;
      --card:#fff;
      --muted:#666;
      --accent1:#eebbc3; /* week 1 */
      --accent2:#b2e6d4; /* week 2 */
      --accent3:#c9d4ff; /* week 3 */
      --ring:#23294620;
    }
    *{box-sizing:border-box}
    body{
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      margin:0; color:#222; background:var(--bg); line-height:1.6;
    }
    header{background:var(--ink); color:#fff; padding:1.5rem; text-align:center}
    header h1{margin:0; font-size:1.8rem}
    main{max-width:860px; margin:2rem auto; background:var(--card); padding:1.25rem 1.25rem 2rem; border-radius:12px; box-shadow:0 2px 10px rgba(0,0,0,.06)}
    section{margin-bottom:2rem}
    section h2{color:var(--ink); margin:.25rem 0 .75rem; font-size:1.35rem}
    .anchors p{margin:.2rem 0; font-size:.95rem}
    ul{padding-left:1.1rem; margin:.5rem 0}
    .muted{color:var(--muted)}
    footer{text-align:center; color:#555; font-size:.9rem; margin:2rem 0}
    .warn{padding:.75rem 1rem; border-radius:8px; background:#fff4f6; color:#7a1c2a; border:1px solid #ffd6df; margin-top:1rem}
    .ok{padding:.5rem .75rem; border-radius:8px; background:#f6ffef; color:#1f5d22; border:1px solid #d7f5c9}
    .dim{opacity:.85}
    .skeleton{
      background:linear-gradient(90deg, #eee, #f6f6f6, #eee);
      background-size:200% 100%;
      animation:shimmer 1.2s infinite;
      height:1rem; border-radius:6px; width:100%;
    }
    @keyframes shimmer {0%{background-position:200% 0}100%{background-position:-200% 0}}
    code.inline{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace; background:#f5f5f5; padding:.1rem .35rem; border-radius:6px}

    /* Weeks with distinct accent borders */
    .week{
      padding-left:1rem; margin:1.25rem 0; border-left:5px solid var(--accent1);
      background:#fff; border-radius:10px; box-shadow:0 1px 6px rgba(0,0,0,.04);
      padding-top:.75rem; padding-bottom:.75rem;
    }
    .week h3{margin:.2rem 0 .6rem}
    .week-1{border-left-color:var(--accent1)}
    .week-2{border-left-color:var(--accent2)}
    .week-3{border-left-color:var(--accent3)}

    /* Accordion styles */
    .practice{margin:.5rem 0 1rem}
    .acc-btn{
      width:100%; text-align:left; background:#f8f9fb; border:1px solid #eef0f5;
      border-radius:10px; padding:.9rem 1rem; display:flex; align-items:center; gap:.75rem;
      cursor:pointer; transition:background .15s ease, border-color .15s ease, box-shadow .15s ease;
    }
    .acc-btn:hover{background:#f3f5fa; border-color:#e6eaf2}
    .acc-btn:focus-visible{outline:none; box-shadow:0 0 0 3px var(--ring)}
    .acc-title{flex:1; font-weight:600; color:#1f2333}
    .acc-icon{
      width:28px; height:28px; border-radius:8px; border:1px solid #e4e7ee; display:grid; place-items:center;
      font-weight:700; font-size:18px; color:#1f2333; user-select:none; transition:transform .2s ease, background .2s ease;
      background:#fff;
    }
    .acc-btn[aria-expanded="true"] .acc-icon{transform:rotate(45deg); background:#f0f4ff}

    .acc-panel{
      border-left:2px dashed #e9ecf2; margin:.6rem 0 0 1rem; padding:.8rem 0 0 .9rem;
    }

    /* Summary polish */
    #protocol-summary .lede{font-size:1rem}
    #protocol-summary .cta{margin-top:.4rem}

    /* Small screen tweaks */
    @media (max-width:600px){
      main{margin:1rem auto; padding:1rem}
      .acc-btn{padding:.8rem .85rem}
      .acc-title{font-size:.98rem}
    }
  </style>
</head>
<body>
  <header>
    <h1>‚ú® Your Hair Recovery Report</h1>
    <p class="dim">Personalized insights from Hairqare</p>
  </header>

  <main>
    <!-- Intro -->
    <section id="intro">
      <h2>Where You Are Right Now</h2>
      <p>This report helps you understand what‚Äôs driving your shedding, where you are in the recovery cycle, and what to focus on over the next 3 weeks. üå±</p>
    </section>
<!-- Recovery Chart -->
<section id="recovery-chart">
    <h2>Your Recovery Curve</h2>
    <div class="chart-card">
        <svg id="curve-svg" viewBox="0 0 1000 380" role="img" aria-label="Hair loss recovery timeline">
            <defs>
              <linearGradient id="g-curve" x1="0" y1="0" x2="1" y2="0">
                <stop offset="0%" stop-color="#0ea5e9"/>
                <stop offset="60%" stop-color="#22c55e"/>
                <stop offset="100%" stop-color="#84cc16"/>
              </linearGradient>
              <linearGradient id="g-fill" x1="0" y1="0" x2="0" y2="1">
                <stop offset="0%" stop-color="#0ea5e910"/>
                <stop offset="100%" stop-color="#0ea5e902"/>
              </linearGradient>
              <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
                <feDropShadow dx="0" dy="2" stdDeviation="6" flood-color="#00000022"/>
              </filter>
            </defs>
          
            <!-- grid and axes -->
            <g stroke="#e9ecf2">
              <line x1="60" y1="300" x2="960" y2="300"/>
              <line x1="60" y1="240" x2="960" y2="240"/>
              <line x1="60" y1="180" x2="960" y2="180"/>
              <line x1="60" y1="120" x2="960" y2="120"/>
            </g>
            <g stroke="#cfd6e3" stroke-width="1">
              <line x1="60" y1="320" x2="960" y2="320"/>
              <line x1="60" y1="60"  x2="60"  y2="320"/>
            </g>
          
            <!-- axis labels -->
            <text x="510" y="365" fill="#6b7280" font-size="13" text-anchor="middle">
              Months relative to hair-loss trigger
            </text>
            <text x="18" y="190" fill="#6b7280" font-size="13" text-anchor="middle"
                  transform="rotate(-90 18 190)">
              Hair density (% of your baseline)
            </text>
          
            <!-- y tick labels -->
            <g fill="#6b7280" font-size="12">
              <text x="24" y="304">90%</text>
              <text x="20" y="244">100%</text>
              <text x="20" y="184">110%</text>
              <text x="20" y="124">120%</text>
            </g>
          
            <!-- x tick labels -->
            <g fill="#6b7280" font-size="12">
              <text x="60"  y="340">-3</text>
              <text x="280" y="340">0</text>
              <text x="500" y="340">3</text>
              <text x="720" y="340">6</text>
              <text x="940" y="340">9</text>
            </g>
          
            <!-- recovery curve -->
            <path id="curve-fill"
                  d="M60,240 C220,240 220,240 280,238
                     C360,235 430,255 500,280
                     C560,300 630,300 700,280
                     C780,255 850,200 940,120
                     L940,320 L60,320 Z"
                  fill="url(#g-fill)"/>
            <path id="curve-stroke"
                  d="M60,240 C220,240 220,240 280,238
                     C360,235 430,255 500,280
                     C560,300 630,300 700,280
                     C780,255 850,200 940,120"
                  fill="none" stroke="url(#g-curve)" stroke-width="4"
                  stroke-linecap="round" filter="url(#shadow)"/>
          
            <!-- red hair loss trigger marker (on top of curve) -->
            <g transform="translate(280,238)">
              <circle r="7" fill="#dc2626"/>
              <circle r="3" fill="white"/>
              <g transform="translate(0,-14)">
                <rect x="-60" y="-26" width="120" height="24" rx="6" fill="#dc2626" opacity="0.95"></rect>
                <text x="0" y="-10" fill="#fff" font-size="12" text-anchor="middle">Hair loss trigger</text>
              </g>
            </g>
          
            <!-- green "you are here" marker -->
            <g id="marker" transform="translate(500,280)">
              <circle r="7" fill="#22c55e" stroke="#111827" stroke-width="2"/>
              <circle r="3" fill="#fff"/>
              <g transform="translate(0,-16)">
                <rect x="-60" y="-26" width="120" height="24" rx="6" fill="#111827" opacity="0.9"></rect>
                <text id="marker-label" x="0" y="-10" fill="#ffffff" font-size="12" text-anchor="middle">You are here</text>
              </g>
            </g>
          </svg>
      <p class="chart-caption muted">This curve shows a typical shedding ‚Üí stabilization ‚Üí regrowth pattern. The dot marks where you are in your journey based on your timeline analysis.</p>
    </div>
  </section>
    <!-- Timeline / Analysis -->
    <section id="timeline">
      <h2>Your Recovery Timeline</h2>
      <div id="timeline-html"><div class="skeleton" style="height:70px"></div></div>
      <div id="anchors" class="anchors muted" style="margin-top:.75rem"></div>
    </section>

    <!-- Protocol Summary -->
    <section id="protocol-summary">
      <h2>Protocol Summary</h2>
      <div id="summary-body" class="muted">
        <div class="skeleton" style="height:18px; width:92%"></div>
        <div class="skeleton" style="height:18px; width:75%; margin-top:.4rem"></div>
      </div>
    </section>

    <!-- Protocols -->
    <section id="protocol">
      <h2>Your 21-Day Reset Plan</h2>

      <!-- Week 1 -->
      <div class="week week-1" id="week1">
        <h3>Week 1: Stabilize Your System üå±</h3>

        <!-- Practice 1 -->
        <div class="practice">
          <button class="acc-btn" aria-expanded="false" aria-controls="p1-body">
            <span class="acc-title" id="p1-title">Practice 1: Consistent Sleep Timing</span>
            <span class="acc-icon" aria-hidden="true">+</span>
          </button>
          <div id="p1-body" class="acc-panel" hidden>
            <div class="muted">
              <div class="skeleton" style="height:18px; width:90%"></div>
              <div class="skeleton" style="height:18px; width:85%; margin-top:.4rem"></div>
            </div>
          </div>
        </div>

        <!-- Practice 2 -->
        <div class="practice">
          <button class="acc-btn" aria-expanded="false" aria-controls="p2-body">
            <span class="acc-title" id="p2-title">Practice 2: Wind-Down Stack</span>
            <span class="acc-icon" aria-hidden="true">+</span>
          </button>
          <div id="p2-body" class="acc-panel" hidden>
            <div class="muted">
              <div class="skeleton" style="height:18px; width:92%"></div>
              <div class="skeleton" style="height:18px; width:70%; margin-top:.4rem"></div>
            </div>
          </div>
        </div>

        <!-- Practice 3 -->
        <div class="practice">
          <button class="acc-btn" aria-expanded="false" aria-controls="p3-body">
            <span class="acc-title" id="p3-title">Practice 3: (will be tailored to you)</span>
            <span class="acc-icon" aria-hidden="true">+</span>
          </button>
          <div id="p3-body" class="acc-panel" hidden>
            <div class="muted">
              <div class="skeleton" style="height:18px; width:88%"></div>
              <div class="skeleton" style="height:18px; width:60%; margin-top:.4rem"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- Week 2 (optional auto-fill if JSON exists) -->
      <div class="week week-2" id="week2">
        <h3>Week 2: Rebuild Your Foundations üí™</h3>
        <div id="w2-body" class="muted">
          <p class="muted">This section will auto-populate soon. For now, keep momentum with Week 1.</p>
        </div>
      </div>

      <!-- Week 3 (optional auto-fill if JSON exists) -->
      <div class="week week-3" id="week3">
        <h3>Week 3: Support Regrowth üå∏</h3>
        <div id="w3-body" class="muted">
          <p class="muted">This section will auto-populate soon. You‚Äôre doing great ‚Äî consistency compounds.</p>
        </div>
      </div>
    </section>

    <!-- Closing -->
    <section id="closing">
      <h2>You‚Äôve Got This ‚ù§Ô∏è</h2>
      <p>Hair recovery takes patience, but every small step adds up. Thousands of women have been exactly where you are ‚Äî and they‚Äôve come through with healthier, stronger hair. Stay consistent, and your future self will thank you. ‚ú®</p>
    </section>

    <div id="messages"></div>
  </main>

  <footer>¬© 2025 Hairqare by Holiniq</footer>

  <script>
    // ---------- Small helpers ----------
    const $ = (sel) => document.querySelector(sel);

    function safeSetHTML(el, html){
      if(!el) return;
      el.innerHTML = String(html ?? '')
        .replaceAll('<script', '&lt;script')
        .replaceAll('onerror=', 'data-oe=');
    }

    async function loadJSON(url){
      const res = await fetch(url, {cache:'no-store'});
      if(!res.ok) throw new Error(`Fetch ${url} failed: ${res.status}`);
      return res.json();
    }

    function showWarn(msg){
      const div = document.createElement('div');
      div.className = 'warn';
      div.textContent = msg;
      $('#messages')?.appendChild(div);
    }

    // ---------- Accordion wiring ----------
    function wireAccordions(){
      document.querySelectorAll('.acc-btn').forEach(btn=>{
        btn.addEventListener('click', ()=>{
          const expanded = btn.getAttribute('aria-expanded') === 'true';
          const panelId = btn.getAttribute('aria-controls');
          const panel = document.getElementById(panelId);
          // toggle
          btn.setAttribute('aria-expanded', String(!expanded));
          if(panel) panel.hidden = expanded;
        });
      });
    }

    // ---------- Boot ----------
    async function boot(){
      wireAccordions(); // enable accordion interactions

      const params = new URLSearchParams(window.location.search);
      const id = params.get('id'); // e.g. ?id=recXXXX
      if(!id){
        showWarn('Missing result id. Append e.g. ' + window.location.pathname + '?id=YOUR_RECORD_ID');
        return;
      }

      // PATHS (index.html is in /results/, so data is ../data/)
      const timelinePath = `../data/${id}.json`;
      const summaryPath  = `../data/protocols/summaries/${id}.json`;
      const week1Path    = `../data/protocols/week1/${id}.json`;
      const week2Path    = `../data/protocols/week2/${id}.json`;
      const week3Path    = `../data/protocols/week3/${id}.json`;

      // 1) Timeline / anchors
      try{
        const data = await loadJSON(timelinePath);
        const result = Array.isArray(data) ? data[0] : data;

        safeSetHTML($('#timeline-html'), result.timeline_html ?? '<p class="muted">No analysis available.</p>');

        const a = result.anchors || {};
        $('#anchors').innerHTML =
          `<p><strong>Worst month:</strong> ${a.worst_month ?? '‚Äî'}</p>
           <p><strong>Main trigger:</strong> ${a.main_trigger ?? '‚Äî'}</p>
           <p><strong>Onset window:</strong> ${a.onset_window ?? '‚Äî'}</p>
           <p><strong>Stabilization by:</strong> ${a.stabilization_by ?? '‚Äî'}</p>
           <p><strong>Stabilization window:</strong> ${a.stabilization_window ?? '‚Äî'}</p>
           <p><strong>Regrowth start:</strong> ${a.regrowth_start ?? '‚Äî'}</p>`;
      }catch(e){
        console.error('Timeline load error:', e);
        showWarn('Could not load your analysis. If this persists, please refresh or try again later.');
      }

      // 2) Protocol Summary
      try{
        const sum = await loadJSON(summaryPath);
        const html =
          sum?.summary_html ??
          sum?.summary?.html ??
          sum?.html ??
          '<p class="muted">Summary not available yet.</p>';
        safeSetHTML($('#summary-body'), html);
      }catch(e){
        console.warn('Summary not loaded', e);
      }

      // 3) Week 1 protocols (expected keys: practice1_title/html, practice2_title/html, practice3_title/html)
      try{
        const prot = await loadJSON(week1Path);

        if(prot?.week1?.practice1_title) $('#p1-title').textContent = prot.week1.practice1_title;
        if(prot?.week1?.practice1_html)  safeSetHTML($('#p1-body'), prot.week1.practice1_html);

        if(prot?.week1?.practice2_title) $('#p2-title').textContent = prot.week1.practice2_title;
        if(prot?.week1?.practice2_html)  safeSetHTML($('#p2-body'), prot.week1.practice2_html);

        if(prot?.week1?.practice3_title) $('#p3-title').textContent = prot.week1.practice3_title;
        if(prot?.week1?.practice3_html)  safeSetHTML($('#p3-body'), prot.week1.practice3_html);
      }catch(e){
        console.warn('Week 1 protocol not loaded (ok for MVP if missing):', e);
      }

      // 4) Week 2 (optional). Expected shape mirrors week1: { "week2": { practice1_title/html, ... } }
      try{
        const w2 = await loadJSON(week2Path);
        if(w2?.week2){
          const blocks = [];
          for(let i=1;i<=3;i++){
            const t = w2.week2[`practice${i}_title`];
            const h = w2.week2[`practice${i}_html`];
            if(t || h){
              // create a mini-accordion block
              const pid = `w2p${i}-body`;
              blocks.push(`
                <div class="practice">
                  <button class="acc-btn" aria-expanded="false" aria-controls="${pid}">
                    <span class="acc-title">${t ?? `Practice ${i}`}</span>
                    <span class="acc-icon" aria-hidden="true">+</span>
                  </button>
                  <div id="${pid}" class="acc-panel" hidden>${h ?? ''}</div>
                </div>
              `);
            }
          }
          if(blocks.length){
            $('#w2-body').innerHTML = blocks.join('');
            wireAccordions();
          }
        }
      }catch(e){
        /* silent for MVP */
      }

      // 5) Week 3 (optional)
      try{
        const w3 = await loadJSON(week3Path);
        if(w3?.week3){
          const blocks = [];
          for(let i=1;i<=3;i++){
            const t = w3.week3[`practice${i}_title`];
            const h = w3.week3[`practice${i}_html`];
            if(t || h){
              const pid = `w3p${i}-body`;
              blocks.push(`
                <div class="practice">
                  <button class="acc-btn" aria-expanded="false" aria-controls="${pid}">
                    <span class="acc-title">${t ?? `Practice ${i}`}</span>
                    <span class="acc-icon" aria-hidden="true">+</span>
                  </button>
                  <div id="${pid}" class="acc-panel" hidden>${h ?? ''}</div>
                </div>
              `);
            }
          }
          if(blocks.length){
            $('#w3-body').innerHTML = blocks.join('');
            wireAccordions();
          }
        }
      }catch(e){
        /* silent for MVP */
      }
    }

    boot();
  </script>
</body>
</html>